#ブロックビンゴにおける戦略

## 1. ブロックビンゴの説明
ブロックビンゴは、以下の2つの要素で構成されている。
  1. ブロックサークル内の黒ブロックの運搬
  2. 交点サークルに置かれたカラーブロック（黒ブロックを含む）の運搬

### 1.1 どちらから先に攻略すればいいのか？
交点サークルに置かれたカラーブロックは、交点サークルから伸びる黒線を走行体がライントレースしながら進み、指定のブロックサークルへ運ぶことで攻略できる。

しかしながら、ブロックサークル内の黒ブロックはブロックサークルの中央に置かれているため、黒線をライントレースするような移動では攻略できない。したがって、走行体は複数のブロックサークルの中心を通りながら走行して攻略することになる。このことから、カラーブロックが配置されているブロックサークルは少ない方が望ましい。

以上のことから、**ブロックサークル内の黒ブロックの運搬を先に攻略**する。

### 1.2 ブロックビンゴの攻略を始めるには何が必要か？
ブロックビンゴの攻略に必要な機能は、以下の5つである。
 1. 数字カードに書かれた数字の認識
 2. ブロックサークルに置かれたカラーブロックの位置
 3. 交点サークルに置かれたカラーブロックの位置
 4. 正確な走行体の移動制御
 5. ブロック運搬における最適経路の探索アルゴリズム

このうち3番目の機能は、交点サークルに置かれたカラーブロックの移動でのみ用いる。なお、1.から3.の機能はカメラシステムを用いた画像処理アルゴリズムで解決する。

# 2.  走行体の移動
1.2節で述べた走行体の移動制御について説明する。走行体は1.1節で述べたように、ブロックビンゴの2つの要素によって走行する場所が異なる。

ブロックサークル内の黒ブロックの運搬時には、走行体はブロックサークルの中心を通りながら移動する。また、交点サークルに置かれたカラーブロックの運搬時には、走行体は交点サークルから伸びる黒線をライントレースしながら移動する。

よって走行体の移動は、ブロックビンゴの2つの要素によって**分けて考える**必要がある。

## 2.1 ブロックサークル内の黒ブロック運搬時の走行体の移動
走行体がブロックサークルの中心を通りながら移動するには、以下の移動制御ができている必要がある。
 1. ブロックサークルの進入
 2. 直進
 3. 左旋回
 4. 右旋回
 5. 180度回頭
 6. ブロックサークルの退出

以降、走行体の移動に関しては開始点、終了点、条件の3つの観点から説明する。また、走行体の座標は(a, b, theta)の3つの変数を用いて説明する。ここで、aとは数字カードの長辺と平行に座標軸をとったx座標の1つである。x軸はゴールゲート方向に正である。また、bとは数字カードの短辺と平行に座標軸をとったy座標の1つである。y軸はガレージ方向に正である。さらにthetaとは、反時計回りを正とした角度(deg)である(-180度 <= theta <= 180度)。theta = 0のとき、走行体はy軸と平行でy座標が正の向きに向いている。

### 2.1.1 ブロックサークルの進入
交点サークルから伸びる黒線の中点に走行体を置き、ブロックサークルの中心に向かって走行する移動である。黒線の長さは、350mmであるから、その中点は175mmである。

|開始点|終了点|条件|
|---|---|---|
|黒線の中点 (a, b, 0)|(a + 175.0, b, 0)|進入したブロックサークルは4または6|

ブロックサークルの進入は、必ず4または6のブロックサークルとする。この理由は、ブロックビンゴを開始したときの走行体の位置と交点サークルに置かれたカラーブロックの初期位置を考慮すると、最も走行体に近いブロックサークルが4または6だからである。

もし「4のブロックサークルに黒ブロックが置かれている」または「4のブロックサークルにブロックが置かれていない」場合、進入するブロックサークルは4とする。それ以外は、6のブロックサークルに進入することとする。

### 2.1.2 直進
ブロックサークルへ進入した状態で、他のブロックサークル方向へまっすぐ進む移動である。黒線の長さは、350mmであるから、2つのブロックサークルの中心間の距離も350mmである。
|走行体の向き|開始点|終了点|条件|
|---|---|---|---|
|y軸が正の方向へ直進|(a, b, 0)|(a + 350.0, b, 0)|なし|
|y軸が負の方向へ直進|(a, b, 180)|(a - 350.0, b, 180)|なし|
|x軸が正の方向へ直進|(a, b, 90)|(a, b + 350.0, 90)|なし|
|x軸が負の方向へ直進|(a, b, -90)|(a, b - 350.0, -90)|なし|

### 2.1.2 左旋回
ブロックサークルへ進入した状態で、反時計回りに90度旋回する移動である。
|開始点|終了点|条件|
|---|---|---|
|(a, b, 0)|(a, b, 90)|なし|

### 2.1.3 右旋回
ブロックサークルへ進入した状態で、時計回りに90度旋回する移動である。
|開始点|終了点|条件|
|---|---|---|
|(a, b, 0)|(a, b, -90)|なし|

### 2.1.4 180度回頭
ブロックサークルへ進入した状態で、反時計回りに180旋回する移動である。
|開始点|終了点|条件|
|---|---|---|
|(a, b, 0)|(a, b, 180)|ブロックを落とさないような回転が必要|
